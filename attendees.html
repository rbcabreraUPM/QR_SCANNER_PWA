<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
   <meta name="mobile-web-app-capable" content="yes">
  
  <title>QR CODE SCANNER</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>




  <style>

  /* css as usual */


/* condition for screen size minimum of 500px */
@media (max-width:500px) {

  /* your conditional / responsive CSS inside this condition */

  

.video-container {
  position: absolute;
  /*top: 10%;*/
  bottom: 10;
  width: 100%;
  height: 50%; 
  padding-top: 70px;

}
  .video-container video {
    /* Make video to at least 100% wide and tall */
    min-width: 100%; 
    min-height: 100%; 

    /* Setting width & height to auto prevents the browser from stretching or squishing the video */
    width: auto;
    height: auto;

    /* Center the video */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
  }
}

</style>




<style type="text/css">
  @media (min-width: 1024px){
    .video-container{
    padding-top: 15px;
    padding-bottom: 0px;
    height: auto;
  }

     #toast-container {
      top: auto !important;
      right: auto !important;
      bottom: 10%;
      left:50%;
    }
  }

  @media (min-width: 1366px){
    .video-container{
   
    padding-bottom: 0px;
    height: auto;
  }

  #preview{
    width: 750px;
  }

      #toast-container {
      top: auto !important;
      right: auto !important;
      bottom: 0%;
      left:50%;
    
    }

  }
</style>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.css"/>
 



<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src ="js/html5-qrcode.min.js"></script>
  <script type="text/javascript" src ="js/jsqrcode-combined.min.js"></script>
  <script type="text/javascript" src="js/instascan.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.js"></script>


<link rel="apple-touch-icon" sizes="57x57" href="img/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="img/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="img/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="img/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="img/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="img/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="img/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="img/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="img/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="img/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="img/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
<link rel="manifest" href="img/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="img/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


</head>
<body>

    <ul id="dropdown1" class="dropdown-content">
  <li><a class="" onclick=AttendanceChecker(1);>Workshop 1</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(2);>Workshop 2</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(3);>Workshop 3</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(4);>Workshop 4</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(5);>Workshop 5</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(6);>Workshop 6</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(7);>Workshop 7</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(8);>Workshop 8</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(9);>Workshop 9</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(10);>Workshop 10</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(11);>Workshop 11</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(12);>Workshop 12</a></li>
  <li class="divider"></li>
  <li><a class="" onclick=AttendanceChecker(13);>Workshop 13</a></li>

</ul>

  <nav id ="main_nav" class="" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="/" class="brand-logo" style="font-size:110%">QR CODE SCANNER</a>
      <ul class="right hide-on-med-and-down">
        <li><a href="/attendees.html">REFRESH</a></li>
          <li><a class="dropdown-button" href="#!" data-activates="dropdown1">WORKSHOP<i class="material-icons right">arrow_drop_down</i></a></li>
          <li ><a id="modal_attendees" class="waves-effect waves-light btn modal-trigger"  href="#attendess_modal">ATTENDEES</a></li>


        
      </ul>


      <ul id="nav-mobile" class="side-nav">
        <li><a href="/attendees.html">REFRESH</a></li>
<!--  <li><a class="dropdown-button" href="#!" data-activates="dropdown1">WORKSHOP<i class="material-icons right">arrow_drop_down</i></a></li>
          <li ><a id="modal_attendees" class="waves-effect waves-light btn modal-trigger"  href="#attendess_modal">ATTENDEES</a></li> -->
        <div>Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>

  </nav>
  <nav id="navbar_breadcrumb" class="">
    <div class="nav-wrapper container">
      <div class="col s12">
        <a href="#" id ="breadcrumb_label" class="breadcrumb"></a>
      </div>
    </div>
  </nav>


<br><br>
  <div  class="video-container">
       <div class="row center ">
            <div class="col m12 s12 l12">
              <video id="preview"></video>
            </div>


             <!-- Modal Structure -->
        <div id="attendess_modal" class="modal modal-fixed-footer">
          <div class="modal-content">
            <h4 id="event_header"></h4>
            
              <div class="col m12 s12 l12">
                 <table  id ="dataTable" class="bordered responsive-table">
                    <thead>
                      <tr>
                          <th>ID</th>
                           <th>Name</th>
                          <th>TIME</th>
                        
                      </tr>
                    </thead>

                    <tbody id="myTable">

                    </tbody>
                  </table>
            </div>
          </div>
          <div id="modal_footer" class=" modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat white-text ">CLOSE</a>
          </div>
        </div>

       </div>
  </div>

   
   <!--  Scripts-->
  
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <script type="text/javascript">
    document.getElementById('breadcrumb_label').innerHTML = "Workshop " + localStorage.getItem('workshop_number');
    document.getElementById('event_header').innerHTML = "Workshop " + localStorage.getItem('workshop_number');
   
    
  </script>



  <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
  <script type="text/javascript">
    

    var config = {
    apiKey: "AIzaSyD1QMwn2nUb6QUUXaSdU8oPZDgMRev76C8",
    authDomain: "clinicqr.firebaseapp.com",
    databaseURL: "https://clinicqr.firebaseio.com",
    projectId: "clinicqr",
    storageBucket: "clinicqr.appspot.com",
    messagingSenderId: "410584252822"
  };
  firebase.initializeApp(config);
  </script>

  <script type="text/javascript">
      var database_ref = firebase.database().ref();

       var date = new Date();  
        date = date.toString();
       var date_event = date.slice(0,-45);
        var date_event_time = date.slice(0,-36);

        
      function writeUserData(event_number, id_name) {
        var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
              insertData(this);
              }
            };
            xhttp.open("GET", "ACC-response-data-expor.xml", true);
            xhttp.send();
          
          function insertData(xml) {
            var i;
            var xmlDoc = xml.responseXML;
            var x = xmlDoc.getElementsByTagName("delegate");
            var badge_name;
            for (i = 0; i <x.length; i++) { 
              if(id_name == String(x[i].getElementsByTagName("unique_id")[0].childNodes[0].nodeValue)){
                badge_name = x[i].getElementsByTagName("badge_name")[0].childNodes[0].nodeValue;
           
           
            firebase.database().ref('attendees/event_number/'+date_event +'/'+ event_number +'/' +id_name).set({
             DateTime: date_event_time,
             BadgeName: badge_name
            });
            Materialize.toast('RECORDED!', 2000); // 4000 is the duration of the toast
                
              }
            }
          }
      }


        function appendToTable(childData,childKey){
             $('#dataTable > tbody:last-child').append(
                  '<tr>'// need to change closing tag to an opening `<tr>` tag.
                 
                  +'<td>'+childKey+'</td>'
                  +'<td>'+childData.BadgeName+'</td>'
                  +'<td>'+childData.DateTime+'</td>'
                 
                  +'</tr>');
        }


       firebase.database().ref('attendees/event_number/'+date_event+"/"+ localStorage.getItem('workshop_number')).once('value', function(snapshot) {
            snapshot.forEach(function(childSnapshot) {
            var childData = childSnapshot.val();
            var childKey = childSnapshot.key;
            console.log(childKey);
            console.log(childData);

             appendToTable(childData,childKey);
          });

            $(document).ready( function () {
                $('#dataTable').DataTable();
            } );
      });




  </script>
    
  <script type="text/javascript">

        let scanner = new Instascan.Scanner({ video: document.getElementById('preview'),mirror: false});
            scanner.addListener('scan', function (content) {
              console.log(content);
                //insert to firebase database
                writeUserData(localStorage.getItem('workshop_number'),content);
            });
            Instascan.Camera.getCameras().then(function (cameras) {
              if (cameras.length > 0) {
                if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
                          scanner.start(cameras[0]);
                         
                  }else{
                            scanner.start(cameras[0]);
                  }
            
              } 
                else {
                console.error('No cameras found.');
              }
            }).catch(function (e) {
              console.error(e);
            });
    </script>


 <script type="text/javascript">
   var $video  = $('preview'),
    $window = $(window); 

      $(window).resize(function(){
          
          var height = $window.height();
          $video.css('height', height);
          
          var videoWidth = $video.width(),
              windowWidth = $window.width(),
          marginLeftAdjust =   (windowWidth - videoWidth) / 2;
          
          $video.css({
              'height': height, 
              'marginLeft' : marginLeftAdjust
          });
      }).resize();

          $(document).ready(function(){
      // the "href" attribute of the modal trigger must specify the modal ID that wants to be triggered
      $('.modal').modal();
    });
         

 </script>
 <script type="text/javascript" src="js/AttendanceChecker.js"></script>
<script type="text/javascript" src="js/breadcrumb_color.js"></script>

</body>
</html>
