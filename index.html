<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
   <meta name="mobile-web-app-capable" content="yes">
  
  <title>QR CODE SCANNER</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>

  <style>

  /* css as usual */


/* condition for screen size minimum of 500px */
@media (max-width:500px) {

  /* your conditional / responsive CSS inside this condition */

  

.video-container {
  position: absolute;
  /*top: 10%;*/
  bottom: 10;
  width: 100%;
  height: 50%; 

}
.video-container video {
  /* Make video to at least 100% wide and tall */
  min-width: 100%; 
  min-height: 100%; 

  /* Setting width & height to auto prevents the browser from stretching or squishing the video */
  width: auto;
  height: auto;

  /* Center the video */
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
}

#info_input{
  padding-top: 400px;
}

 

}

</style>

<style type="text/css">
  @media (min-width: 1024px){
    .video-container{
    padding-bottom: 0px;
    height: auto;
  }
  }
</style>



<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src ="js/html5-qrcode.min.js"></script>
  <script type="text/javascript" src ="js/jsqrcode-combined.min.js"></script>
  <script type="text/javascript" src="js/instascan.min.js"></script>



<link rel="apple-touch-icon" sizes="57x57" href="img/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="img/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="img/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="img/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="img/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="img/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="img/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="img/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="img/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="img/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="img/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
<link rel="manifest" href="img/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="img/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


</head>
<body>
  <nav class=" indigo darken-2" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="/" class="brand-logo" style="font-size:110%">QR CODE SCANNER</a>
      <ul class="right hide-on-med-and-down">
        <li><a href="https://rbcabreraupm.github.io/QR_SCANNER_PWA/">REFRESH</a></li>
      </ul>

      <ul id="nav-mobile" class="side-nav">
        <li><a href="https://rbcabreraupm.github.io/QR_SCANNER_PWA/">REFRESH</a></li>

        <div>Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
  </nav>

  <div style="padding-top: 70px;" class="center video-container">
       <div class="row ">
            <video id="preview"></video>
       </div>
  </div>


    <div id ="info_input" class="container">
      <form class="col s12">
          <div  class="row">
             <div  style="padding-top: 15px;padding-left: 50px" class="col s6 l4">
             <select class = "source">
                <option value="" disabled>Choose your option</option>
                <option value="select_id">ID</option>
                <option value="select_email">EMAIL</option>
              </select>
              <label>INPUT SELECTION</label>
          </div>

        <div class="input-field col s6 l5">
            <div id = "source_input_field_id_div">
                   <input id="source_input_field_id" type="text" class="validate" required>
                    <label for="source_input_field_id">ID</label>
            </div>

            <div id = "source_input_field_email_div">
                     <input id="source_input_field_email" type="email" class="validate" required>
                      <label for="source_input_field_email">Email</label>
             </div>
         </div>

         <div style="padding-top: 15px">
            <a onclick="getInfo()"; class="waves-effect waves-light btn">SUBMIT</a>
         </div>
      </div>
</div>
   
   <!--  Scripts-->
  
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
    
  <script type="text/javascript">
        let scanner = new Instascan.Scanner({ video: document.getElementById('preview'),mirror: false});
            scanner.addListener('scan', function (content) {
              console.log(content);
             localStorage.setItem("value",content);
                window.location.replace("trial.html");
            });
            Instascan.Camera.getCameras().then(function (cameras) {
              if (cameras.length > 0) {
                if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
                          scanner.start(cameras[0]);
                          console.log("phone")
                  }else{
                            scanner.start(cameras[0]);
                  }
            
              } 
                else {
                console.error('No cameras found.');
              }
            }).catch(function (e) {
              console.error(e);
            });
    </script>


 <script type="text/javascript">
   var $video  = $('preview'),
    $window = $(window); 

      $(window).resize(function(){
          
          var height = $window.height();
          $video.css('height', height);
          
          var videoWidth = $video.width(),
              windowWidth = $window.width(),
          marginLeftAdjust =   (windowWidth - videoWidth) / 2;
          
          $video.css({
              'height': height, 
              'marginLeft' : marginLeftAdjust
          });
      }).resize();

 </script>

<script type="text/javascript">
  
  function getInfo(){
    /*var input_value = document.getElementById('source_input_field').value;*/
     var selectedSource = $(".source option:selected").val();
     var input_value;
      if(String(selectedSource) == 'select_id'){
        input_value = document.getElementById('source_input_field_id').value;
            loadIDpage(input_value);
       
        }
        else{
          input_value = document.getElementById('source_input_field_email').value;
          if(validate(input_value)){
                  loadIDpage(input_value,1);
          }
        }
    
  }

  function validate(email) {
    var emailFilter = /^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+.)+([a-zA-Z0-9]{2,4})+$/;


    if (!emailFilter.test(email)) {
        alert('Please enter a valid e-mail address.');
        return false;
    }

   

    return true;
}

  function loadIDpage(value){
               localStorage.setItem("value",value);
                window.location.replace("trial.html");
  }

   function loadIDpage(value,email_used){
              console.log('email_used');
               localStorage.setItem("value",value);
               localStorage.setItem("isEmailUsed",email_used);
                window.location.replace("trial.html");
  }
</script>

<script type="text/javascript">
$(document).ready(function(){
    //hide email form
    $("#source_input_field_email_div").hide();


    $("select.source").change(function(){
        var selectedSource = $(".source option:selected").val();
        if(String(selectedSource) == 'select_id'){
          $("#source_input_field_id_div").show();
          $("#source_input_field_email_div").hide();
       
        }
        else{
          $("#source_input_field_id_div").hide();
          $("#source_input_field_email_div").show();
        }


    
    });
});
</script>
 <script type="text/javascript">
      if (navigator.serviceWorker.controller) {
        console.log('[PWA Builder] active service worker found, no need to register')
      } else {
        //Register the ServiceWorker
        navigator.serviceWorker.register('pwabuilder-sw.js', {
          scope: './'
        }).then(function(reg) {
          console.log('Service worker has been registered for scope:'+ reg.scope);
        });
      }
    </script>

    


  </body>


</html>
